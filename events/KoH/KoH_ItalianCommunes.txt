namespace = KOH_ItalianCommunes

KOH_ItalianCommunes.1 = {
	type = character_event
	hidden = yes
	theme = dynasty
	left_portrait = root

	immediate = {
		if = {
			limit = {
				exists = house
			}
			primary_title = {
				save_scope_as = republic_title

				add_to_variable_list = {
					name = Republican_houses
					target = root.house
				}
			}
			every_vassal_or_below = {
				limit = {
					exists = house
					house = {
						any_house_member = {
							count >= 3
						}
					}
				}
				scope:republic_title = {
					add_to_variable_list = {
						name = Republican_houses
						target = prev.house
					}
				}
			}
			every_courtier = {
				limit = {
					exists = house
					house = {
						any_house_member = {
							count >= 3
						}
					}
				}
				scope:republic_title = {
					add_to_variable_list = {
						name = Republican_houses
						target = prev.house
					}
				}
			}
		}
	}
}

KOH_ItalianCommunes.2 = {
	type = character_event
	title = KOH_ItalianCommunes.4.t
	desc = {
		desc = KOH_ItalianCommunes.4.desc
	}
	theme = dynasty
	left_portrait = root

	immediate = {

	}
	option = {
		name = KOH_ItalianCommunes.4.a

		primary_title = {
			if = {
				limit = {
					any_in_list = {
						variable = Republican_houses
						count >= 1
					}
				}
				
				every_in_list = {
					variable = Republican_houses
					house_head = {
						add_gold = 10
					}
				}
			}
		}
	}
}

#Election Candidates!
KOH_ItalianCommunes.4 = {
	type = character_event
	title = KOH_ItalianCommunes.4.t
	desc = {
		desc = KOH_ItalianCommunes.4.desc
	}
	theme = dynasty
	left_portrait = root

	immediate = {
		save_scope_as = republic_holder
		primary_title = {
			save_scope_as = republic_title
		}
		every_held_title = {
			add_to_list = held_titles
		}
		scope:republic_title = {
			#FIRST CANDIDATE
			if = {
				limit = {
					any_in_list = {
						variable = Republican_houses
						count >= 2
					}
				}

				random_in_list = {
					variable = Republican_houses
					limit = {
						NOT = {
							this = root.house
						}
					}
					save_scope_as = house_1
					ordered_house_member = {
						limit = {
							is_male = yes
							age >= 18
							NOR = {
								has_trait = incapable
								has_trait = infirm
							}
						}
						order_by = {
							value = 0
							# Ideally ones with at least a bit of the relevant skills.
							if = {
								limit = { diplomacy >= decent_skill_rating }
								add = 15
							}
							#Educations can help political opinion!
							if = {
								limit = { has_trait = education_stewardship_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_stewardship_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_stewardship_4 }
								add = 20
							}
							#Diplo
							if = {
								limit = { has_trait = education_diplomacy_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_diplomacy_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_diplomacy_4 }
								add = 20
							}
							#Martial
							if = {
								limit = { 
									has_trait = education_martial_4
									scope:republic_title.holder = {
										is_at_war = yes
									}
								}
								add = 50
							}
							if = {
								limit = { has_trait = education_martial_4 }
								add = 20
							}
							#Intriuge
							if = {
								limit = { has_trait = education_intrigue_4 }
								add = 20
							}
							if = {
								limit = { has_trait = diligent }
								add = 20
							}
							if = {
								limit = { has_trait = just }
								add = 30
							}
							if = {
								limit = { has_trait = diplomat }
								add = 20
							}
							if = {
								limit = { has_trait = architect }
								add = 20
							}
							if = {
								limit = { has_trait = administrator }
								add = 20
							}
						}
						save_scope_as = ElectionCandidate
					}
				}
			}
			#SECOND CANDIDATE
			if = {
				limit = {
					any_in_list = {
						variable = Republican_houses
						count >= 3
					}
				}
				
				random_in_list = {
					variable = Republican_houses
					save_scope_as = house_2
					limit = {
						NOT = {
							this = scope:house_1
							this = root.house
						}
					}
					ordered_house_member = {
						limit = {
							is_male = yes
							age >= 18
							NOR = {
								has_trait = incapable
								has_trait = infirm
							}
						}
						order_by = {
							value = 0
							# Ideally ones with at least a bit of the relevant skills.
							if = {
								limit = { diplomacy >= decent_skill_rating }
								add = 15
							}
							#Educations can help political opinion!
							if = {
								limit = { has_trait = education_stewardship_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_stewardship_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_stewardship_4 }
								add = 20
							}
							#Diplo
							if = {
								limit = { has_trait = education_diplomacy_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_diplomacy_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_diplomacy_4 }
								add = 20
							}
							#Martial
							if = {
								limit = { 
									has_trait = education_martial_4
									scope:republic_title.holder = {
										is_at_war = yes
									}
								}
								add = 50
							}
							if = {
								limit = { has_trait = education_martial_4 }
								add = 20
							}
							#Intriuge
							if = {
								limit = { has_trait = education_intrigue_4 }
								add = 20
							}
							if = {
								limit = { has_trait = diligent }
								add = 20
							}
							if = {
								limit = { has_trait = just }
								add = 30
							}
							if = {
								limit = { has_trait = diplomat }
								add = 20
							}
							if = {
								limit = { has_trait = architect }
								add = 20
							}
							if = {
								limit = { has_trait = administrator }
								add = 20
							}
						}
						save_scope_as = ElectionCandidate2
					}
				}
			}
			#THIRD CANDIDATE
			if = {
				limit = {
					any_in_list = {
						variable = Republican_houses
						count >= 4
					}
				}
				
				random_in_list = {
					variable = Republican_houses
					save_scope_as = house_3
					limit = {
						NOT = {
							this = scope:house_1
							this = scope:house_2
							this = root.house
						}
					}
					ordered_house_member = {
						limit = {
							is_male = yes
							age >= 18
							NOR = {
								has_trait = incapable
								has_trait = infirm
							}
						}
						order_by = {
							value = 0
							# Ideally ones with at least a bit of the relevant skills.
							if = {
								limit = { diplomacy >= decent_skill_rating }
								add = 15
							}
							#Educations can help political opinion!
							if = {
								limit = { has_trait = education_stewardship_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_stewardship_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_stewardship_4 }
								add = 20
							}
							#Diplo
							if = {
								limit = { has_trait = education_diplomacy_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_diplomacy_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_diplomacy_4 }
								add = 20
							}
							#Martial
							if = {
								limit = { 
									has_trait = education_martial_4
									scope:republic_title.holder = {
										is_at_war = yes
									}
								}
								add = 50
							}
							if = {
								limit = { has_trait = education_martial_4 }
								add = 20
							}
							#Intriuge
							if = {
								limit = { has_trait = education_intrigue_4 }
								add = 20
							}
							if = {
								limit = { has_trait = diligent }
								add = 20
							}
							if = {
								limit = { has_trait = just }
								add = 30
							}
							if = {
								limit = { has_trait = diplomat }
								add = 20
							}
							if = {
								limit = { has_trait = architect }
								add = 20
							}
							if = {
								limit = { has_trait = administrator }
								add = 20
							}
						}
						save_scope_as = ElectionCandidate3
					}
				}
			}
			#FOURTH CANDIDATE
			if = {
				limit = {
					any_in_list = {
						variable = Republican_houses
						count >= 5
					}
				}
				
				random_in_list = {
					variable = Republican_houses
					save_scope_as = house_4
					limit = {
						NOT = {
							this = scope:house_1
							this = scope:house_2
							this = scope:house_3
							this = root.house
						}
					}
					ordered_house_member = {
						limit = {
							is_male = yes
							age >= 18
							NOR = {
								has_trait = incapable
								has_trait = infirm
							}
						}
						order_by = {
							value = 0
							# Ideally ones with at least a bit of the relevant skills.
							if = {
								limit = { diplomacy >= decent_skill_rating }
								add = 15
							}
							#Educations can help political opinion!
							if = {
								limit = { has_trait = education_stewardship_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_stewardship_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_stewardship_4 }
								add = 20
							}
							#Diplo
							if = {
								limit = { has_trait = education_diplomacy_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_diplomacy_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_diplomacy_4 }
								add = 20
							}
							#Martial
							if = {
								limit = { 
									has_trait = education_martial_4
									scope:republic_title.holder = {
										is_at_war = yes
									}
								}
								add = 50
							}
							if = {
								limit = { has_trait = education_martial_4 }
								add = 20
							}
							#Intriuge
							if = {
								limit = { has_trait = education_intrigue_4 }
								add = 20
							}
							if = {
								limit = { has_trait = diligent }
								add = 20
							}
							if = {
								limit = { has_trait = just }
								add = 30
							}
							if = {
								limit = { has_trait = diplomat }
								add = 20
							}
							if = {
								limit = { has_trait = architect }
								add = 20
							}
							if = {
								limit = { has_trait = administrator }
								add = 20
							}
						}
						save_scope_as = ElectionCandidate4
					}
				}
			}
			#FIFTH CANDIDATE
			if = {
				limit = {
					any_in_list = {
						variable = Republican_houses
						count >= 6
					}
				}
				
				random_in_list = {
					variable = Republican_houses
					save_scope_as = house_5
					limit = {
						NOT = {
							this = scope:house_1
							this = scope:house_2
							this = scope:house_3
							this = scope:house_4
							this = root.house
						}
					}
					ordered_house_member = {
						limit = {
							is_male = yes
							age >= 18
							NOR = {
								has_trait = incapable
								has_trait = infirm
							}
						}
						order_by = {
							value = 0
							# Ideally ones with at least a bit of the relevant skills.
							if = {
								limit = { diplomacy >= decent_skill_rating }
								add = 15
							}
							#Educations can help political opinion!
							if = {
								limit = { has_trait = education_stewardship_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_stewardship_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_stewardship_4 }
								add = 20
							}
							#Diplo
							if = {
								limit = { has_trait = education_diplomacy_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_diplomacy_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_diplomacy_4 }
								add = 20
							}
							#Martial
							if = {
								limit = { 
									has_trait = education_martial_4
									scope:republic_title.holder = {
										is_at_war = yes
									}
								}
								add = 50
							}
							if = {
								limit = { has_trait = education_martial_4 }
								add = 20
							}
							#Intriuge
							if = {
								limit = { has_trait = education_intrigue_4 }
								add = 20
							}
							if = {
								limit = { has_trait = diligent }
								add = 20
							}
							if = {
								limit = { has_trait = just }
								add = 30
							}
							if = {
								limit = { has_trait = diplomat }
								add = 20
							}
							if = {
								limit = { has_trait = architect }
								add = 20
							}
							if = {
								limit = { has_trait = administrator }
								add = 20
							}
						}
						save_scope_as = ElectionCandidate5
					}
				}
			}
		}
	}

	#Option 1
	option = {
		name = KOH_ItalianCommunes.4.a
		custom_tooltip = "Run for Releection"
		random_list = {
			25 = { #ElectionCandidate1
				trigger = {
					exists = scope:ElectionCandidate
				}
				scope:ElectionCandidate = {
					create_title_and_vassal_change = {
						type = 	election
						save_scope_as = change
						add_claim_on_loss = yes
					}
					scope:republic_title = {
						change_title_holder = {
							holder = scope:ElectionCandidate
							change = scope:change
						}
					}
					every_in_list = {
						list = held_titles
						change_title_holder = {
							holder = scope:ElectionCandidate
							change = scope:change
						}
					}

					resolve_title_and_vassal_change = scope:change
					hidden_effect = { change_government = republic_government }
					add_character_flag = {
						flag = RecentElection
						months = 60
					}
				}

				send_interface_toast = {
					type = event_toast_effect_good
					custom_tooltip = "You will play as them"
					title = "[ElectionCandidate.GetName] has won the election"
					left_icon = scope:ElectionCandidate
				}
			}

			25 = { #ElectionCandidate2
				trigger = {
					exists = scope:ElectionCandidate2
				}
				scope:ElectionCandidate2 = {
					create_title_and_vassal_change = {
						type = election
						save_scope_as = change
						add_claim_on_loss = yes
					}
					scope:republic_title = {
						change_title_holder = {
							holder = scope:ElectionCandidate2
							change = scope:change
						}
					}
					every_in_list = {
						list = held_titles
						change_title_holder = {
							holder = scope:ElectionCandidate2
							change = scope:change
						}
					}
					resolve_title_and_vassal_change = scope:change
					hidden_effect = { change_government = republic_government }
					add_character_flag = {
						flag = RecentElection
						months = 60
					}
				}

				send_interface_toast = {
					type = event_toast_effect_good
					custom_tooltip = "You will play as them"
					title = "[ElectionCandidate2.GetName] has won the election"
					left_icon = scope:ElectionCandidate2
				}
			}
		
			25 = { #ElectionCandidate3
				trigger = {
					exists = scope:ElectionCandidate3
				}
				scope:ElectionCandidate3 = {
					create_title_and_vassal_change = {
						type = election
						save_scope_as = change
						add_claim_on_loss = yes
					}
					scope:republic_title = {
						change_title_holder = {
							holder = scope:ElectionCandidate3
							change = scope:change
						}
					}
					every_in_list = {
						list = held_titles
						change_title_holder = {
							holder = scope:ElectionCandidate3
							change = scope:change
						}
					}
					resolve_title_and_vassal_change = scope:change
					hidden_effect = { change_government = republic_government }
					add_character_flag = {
						flag = RecentElection
						months = 60
					}
				}

				send_interface_toast = {
					type = event_toast_effect_good
					custom_tooltip = "You will play as them"
					title = "[ElectionCandidate3.GetName] has won the election"
					left_icon = scope:ElectionCandidate3
				}
			}
	

			25 = { #ElectionCandidate4
				trigger = {
					exists = scope:ElectionCandidate4
				}
			
				scope:ElectionCandidate4 = {
					create_title_and_vassal_change = {
						type = election
						save_scope_as = change
						add_claim_on_loss = yes
					}
					scope:republic_title = {
						change_title_holder = {
							holder = scope:ElectionCandidate4
							change = scope:change
						}
					}
					every_in_list = {
						list = held_titles
						change_title_holder = {
							holder = scope:ElectionCandidate4
							change = scope:change
						}
					}
					resolve_title_and_vassal_change = scope:change
					hidden_effect = { change_government = republic_government }
					add_character_flag = {
						flag = RecentElection
						months = 60
					}
				}

				send_interface_toast = {
					type = event_toast_effect_good
					custom_tooltip = "You will play as them"
					title = "[ElectionCandidate4.GetName] has won the election"
					left_icon = scope:ElectionCandidate4
				}
			}

			25 = { #ElectionCandidate5
				trigger = {
					exists = scope:ElectionCandidate5
				}
				scope:ElectionCandidate5 = {
					create_title_and_vassal_change = {
						type = election
						save_scope_as = change
						add_claim_on_loss = yes
					}
					scope:republic_title = {
						change_title_holder = {
							holder = scope:ElectionCandidate5
							change = scope:change
						}
					}
					every_in_list = {
						list = held_titles
						change_title_holder = {
							holder = scope:ElectionCandidate5
							change = scope:change
						}
					}
					resolve_title_and_vassal_change = scope:change
					hidden_effect = { change_government = republic_government }
					add_character_flag = {
						flag = RecentElection
						months = 60
					}
				}

				send_interface_toast = {
					type = event_toast_effect_good
					custom_tooltip = "You will play as them"
					title = "[ElectionCandidate5.GetName] has won the election"
					left_icon = scope:ElectionCandidate5
				}
			}
			25 = {
				custom_tooltip = "You win the election, and retain controll over the republic."
				send_interface_toast = {
					type = event_toast_effect_good
					#custom_tooltip = "You will play as them"
					title = "[republic_holder.GetName] has won the election"
					left_icon = scope:republic_holder
				}
			}
		}
	}
}

#Election Candidates!
KOH_ItalianCommunes.5 = {
	type = character_event
	hidden = yes
	theme = dynasty
	left_portrait = root

	trigger = {
		exists = primary_title
		primary_title = {
			any_in_list = {
				variable = Republican_houses
				count >= 1
			}
		}
	}

	immediate = {
		save_scope_as = republic_holder
		primary_title = {
			save_scope_as = republic_title
		}
		every_held_title = {
			add_to_list = held_titles
		}

		scope:republic_title = {
			#FIRST CANDIDATE
			if = {
				limit = {
					any_in_list = {
						variable = Republican_houses
						count >= 2
					}
				}

				random_in_list = {
					variable = Republican_houses
					limit = {
						NOT = {
							this = root.house
						}
					}
					save_scope_as = house_1
					ordered_house_member = {
						limit = {
							is_male = yes
							age >= 18
							NOR = {
								has_trait = incapable
								has_trait = infirm
							}
						}
						order_by = {
							value = 0
							# Ideally ones with at least a bit of the relevant skills.
							if = {
								limit = { diplomacy >= decent_skill_rating }
								add = 15
							}
							#Educations can help political opinion!
							if = {
								limit = { has_trait = education_stewardship_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_stewardship_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_stewardship_4 }
								add = 20
							}
							#Diplo
							if = {
								limit = { has_trait = education_diplomacy_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_diplomacy_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_diplomacy_4 }
								add = 20
							}
							#Martial
							if = {
								limit = { 
									has_trait = education_martial_4
									scope:republic_title.holder = {
										is_at_war = yes
									}
								}
								add = 50
							}
							if = {
								limit = { has_trait = education_martial_4 }
								add = 20
							}
							#Intriuge
							if = {
								limit = { has_trait = education_intrigue_4 }
								add = 20
							}
							if = {
								limit = { has_trait = diligent }
								add = 20
							}
							if = {
								limit = { has_trait = just }
								add = 30
							}
							if = {
								limit = { has_trait = diplomat }
								add = 20
							}
							if = {
								limit = { has_trait = architect }
								add = 20
							}
							if = {
								limit = { has_trait = administrator }
								add = 20
							}
						}
						save_scope_as = ElectionCandidate
					}
				}
			}
			#SECOND CANDIDATE
			if = {
				limit = {
					any_in_list = {
						variable = Republican_houses
						count >= 3
					}
				}
				
				random_in_list = {
					variable = Republican_houses
					save_scope_as = house_2
					limit = {
						NOT = {
							this = scope:house_1
							this = root.house
						}
					}
					ordered_house_member = {
						limit = {
							is_male = yes
							age >= 18
							NOR = {
								has_trait = incapable
								has_trait = infirm
							}
						}
						order_by = {
							value = 0
							# Ideally ones with at least a bit of the relevant skills.
							if = {
								limit = { diplomacy >= decent_skill_rating }
								add = 15
							}
							#Educations can help political opinion!
							if = {
								limit = { has_trait = education_stewardship_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_stewardship_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_stewardship_4 }
								add = 20
							}
							#Diplo
							if = {
								limit = { has_trait = education_diplomacy_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_diplomacy_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_diplomacy_4 }
								add = 20
							}
							#Martial
							if = {
								limit = { 
									has_trait = education_martial_4
									scope:republic_title.holder = {
										is_at_war = yes
									}
								}
								add = 50
							}
							if = {
								limit = { has_trait = education_martial_4 }
								add = 20
							}
							#Intriuge
							if = {
								limit = { has_trait = education_intrigue_4 }
								add = 20
							}
							if = {
								limit = { has_trait = diligent }
								add = 20
							}
							if = {
								limit = { has_trait = just }
								add = 30
							}
							if = {
								limit = { has_trait = diplomat }
								add = 20
							}
							if = {
								limit = { has_trait = architect }
								add = 20
							}
							if = {
								limit = { has_trait = administrator }
								add = 20
							}
						}
						save_scope_as = ElectionCandidate2
					}
				}
			}
			#THIRD CANDIDATE
			if = {
				limit = {
					any_in_list = {
						variable = Republican_houses
						count >= 4
					}
				}
				
				random_in_list = {
					variable = Republican_houses
					save_scope_as = house_3
					limit = {
						NOT = {
							this = scope:house_1
							this = scope:house_2
							this = root.house
						}
					}
					ordered_house_member = {
						limit = {
							is_male = yes
							age >= 18
							NOR = {
								has_trait = incapable
								has_trait = infirm
							}
						}
						order_by = {
							value = 0
							# Ideally ones with at least a bit of the relevant skills.
							if = {
								limit = { diplomacy >= decent_skill_rating }
								add = 15
							}
							#Educations can help political opinion!
							if = {
								limit = { has_trait = education_stewardship_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_stewardship_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_stewardship_4 }
								add = 20
							}
							#Diplo
							if = {
								limit = { has_trait = education_diplomacy_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_diplomacy_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_diplomacy_4 }
								add = 20
							}
							#Martial
							if = {
								limit = { 
									has_trait = education_martial_4
									scope:republic_title.holder = {
										is_at_war = yes
									}
								}
								add = 50
							}
							if = {
								limit = { has_trait = education_martial_4 }
								add = 20
							}
							#Intriuge
							if = {
								limit = { has_trait = education_intrigue_4 }
								add = 20
							}
							if = {
								limit = { has_trait = diligent }
								add = 20
							}
							if = {
								limit = { has_trait = just }
								add = 30
							}
							if = {
								limit = { has_trait = diplomat }
								add = 20
							}
							if = {
								limit = { has_trait = architect }
								add = 20
							}
							if = {
								limit = { has_trait = administrator }
								add = 20
							}
						}
						save_scope_as = ElectionCandidate3
					}
				}
			}
			#FOURTH CANDIDATE
			if = {
				limit = {
					any_in_list = {
						variable = Republican_houses
						count >= 5
					}
				}
				
				random_in_list = {
					variable = Republican_houses
					save_scope_as = house_4
					limit = {
						NOT = {
							this = scope:house_1
							this = scope:house_2
							this = scope:house_3
							this = root.house
						}
					}
					ordered_house_member = {
						limit = {
							is_male = yes
							age >= 18
							NOR = {
								has_trait = incapable
								has_trait = infirm
							}
						}
						order_by = {
							value = 0
							# Ideally ones with at least a bit of the relevant skills.
							if = {
								limit = { diplomacy >= decent_skill_rating }
								add = 15
							}
							#Educations can help political opinion!
							if = {
								limit = { has_trait = education_stewardship_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_stewardship_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_stewardship_4 }
								add = 20
							}
							#Diplo
							if = {
								limit = { has_trait = education_diplomacy_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_diplomacy_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_diplomacy_4 }
								add = 20
							}
							#Martial
							if = {
								limit = { 
									has_trait = education_martial_4
									scope:republic_title.holder = {
										is_at_war = yes
									}
								}
								add = 50
							}
							if = {
								limit = { has_trait = education_martial_4 }
								add = 20
							}
							#Intriuge
							if = {
								limit = { has_trait = education_intrigue_4 }
								add = 20
							}
							if = {
								limit = { has_trait = diligent }
								add = 20
							}
							if = {
								limit = { has_trait = just }
								add = 30
							}
							if = {
								limit = { has_trait = diplomat }
								add = 20
							}
							if = {
								limit = { has_trait = architect }
								add = 20
							}
							if = {
								limit = { has_trait = administrator }
								add = 20
							}
						}
						save_scope_as = ElectionCandidate4
					}
				}
			}
			#FIFTH CANDIDATE
			if = {
				limit = {
					any_in_list = {
						variable = Republican_houses
						count >= 6
					}
				}
				
				random_in_list = {
					variable = Republican_houses
					save_scope_as = house_5
					limit = {
						NOT = {
							this = scope:house_1
							this = scope:house_2
							this = scope:house_3
							this = scope:house_4
							this = root.house
						}
					}
					ordered_house_member = {
						limit = {
							is_male = yes
							age >= 18
							NOR = {
								has_trait = incapable
								has_trait = infirm
							}
						}
						order_by = {
							value = 0
							# Ideally ones with at least a bit of the relevant skills.
							if = {
								limit = { diplomacy >= decent_skill_rating }
								add = 15
							}
							#Educations can help political opinion!
							if = {
								limit = { has_trait = education_stewardship_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_stewardship_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_stewardship_4 }
								add = 20
							}
							#Diplo
							if = {
								limit = { has_trait = education_diplomacy_2 }
								add = 5
							}
							if = {
								limit = { has_trait = education_diplomacy_3 }
								add = 10
							}
							if = {
								limit = { has_trait = education_diplomacy_4 }
								add = 20
							}
							#Martial
							if = {
								limit = { 
									has_trait = education_martial_4
									scope:republic_title.holder = {
										is_at_war = yes
									}
								}
								add = 50
							}
							if = {
								limit = { has_trait = education_martial_4 }
								add = 20
							}
							#Intriuge
							if = {
								limit = { has_trait = education_intrigue_4 }
								add = 20
							}
							if = {
								limit = { has_trait = diligent }
								add = 20
							}
							if = {
								limit = { has_trait = just }
								add = 30
							}
							if = {
								limit = { has_trait = diplomat }
								add = 20
							}
							if = {
								limit = { has_trait = architect }
								add = 20
							}
							if = {
								limit = { has_trait = administrator }
								add = 20
							}
						}
						save_scope_as = ElectionCandidate5
					}
				}
			}
		}
	}

	#Option 1
	option = {
		name = KOH_ItalianCommunes.5.a
		custom_tooltip = "Run for Releection"
		random_list = {
			25 = { #ElectionCandidate1
				trigger = {
					exists = scope:ElectionCandidate
				}
				scope:ElectionCandidate = {
					create_title_and_vassal_change = {
						type = 	election
						save_scope_as = change
						add_claim_on_loss = yes
					}
					scope:republic_title = {
						change_title_holder = {
							holder = scope:ElectionCandidate
							change = scope:change
						}
					}
					every_in_list = {
						list = held_titles
						change_title_holder = {
							holder = scope:ElectionCandidate
							change = scope:change
						}
					}

					resolve_title_and_vassal_change = scope:change
					hidden_effect = { change_government = republic_government }
					add_character_flag = {
						flag = RecentElection
						months = 60
					}
				}

				send_interface_toast = {
					type = event_toast_effect_good
					custom_tooltip = "You will play as them"
					title = "[ElectionCandidate.GetName] has won the election"
					left_icon = scope:ElectionCandidate
				}
			}

			25 = { #ElectionCandidate2
				trigger = {
					exists = scope:ElectionCandidate2
				}
				scope:ElectionCandidate2 = {
					create_title_and_vassal_change = {
						type = election
						save_scope_as = change
						add_claim_on_loss = yes
					}
					scope:republic_title = {
						change_title_holder = {
							holder = scope:ElectionCandidate2
							change = scope:change
						}
					}
					every_in_list = {
						list = held_titles
						change_title_holder = {
							holder = scope:ElectionCandidate2
							change = scope:change
						}
					}
					resolve_title_and_vassal_change = scope:change
					hidden_effect = { change_government = republic_government }
					add_character_flag = {
						flag = RecentElection
						months = 60
					}
				}

				send_interface_toast = {
					type = event_toast_effect_good
					custom_tooltip = "You will play as them"
					title = "[ElectionCandidate2.GetName] has won the election"
					left_icon = scope:ElectionCandidate2
				}
			}
		
			25 = { #ElectionCandidate3
				trigger = {
					exists = scope:ElectionCandidate3
				}
				scope:ElectionCandidate3 = {
					create_title_and_vassal_change = {
						type = election
						save_scope_as = change
						add_claim_on_loss = yes
					}
					scope:republic_title = {
						change_title_holder = {
							holder = scope:ElectionCandidate3
							change = scope:change
						}
					}
					every_in_list = {
						list = held_titles
						change_title_holder = {
							holder = scope:ElectionCandidate3
							change = scope:change
						}
					}
					resolve_title_and_vassal_change = scope:change
					hidden_effect = { change_government = republic_government }
					add_character_flag = {
						flag = RecentElection
						months = 60
					}
				}

				send_interface_toast = {
					type = event_toast_effect_good
					custom_tooltip = "You will play as them"
					title = "[ElectionCandidate3.GetName] has won the election"
					left_icon = scope:ElectionCandidate3
				}
			}
	

			25 = { #ElectionCandidate4
				trigger = {
					exists = scope:ElectionCandidate4
				}
			
				scope:ElectionCandidate4 = {
					create_title_and_vassal_change = {
						type = election
						save_scope_as = change
						add_claim_on_loss = yes
					}
					scope:republic_title = {
						change_title_holder = {
							holder = scope:ElectionCandidate4
							change = scope:change
						}
					}
					every_in_list = {
						list = held_titles
						change_title_holder = {
							holder = scope:ElectionCandidate4
							change = scope:change
						}
					}
					resolve_title_and_vassal_change = scope:change
					hidden_effect = { change_government = republic_government }
					add_character_flag = {
						flag = RecentElection
						months = 60
					}
				}

				send_interface_toast = {
					type = event_toast_effect_good
					custom_tooltip = "You will play as them"
					title = "[ElectionCandidate4.GetName] has won the election"
					left_icon = scope:ElectionCandidate4
				}
			}

			25 = { #ElectionCandidate5
				trigger = {
					exists = scope:ElectionCandidate5
				}
				scope:ElectionCandidate5 = {
					create_title_and_vassal_change = {
						type = election
						save_scope_as = change
						add_claim_on_loss = yes
					}
					scope:republic_title = {
						change_title_holder = {
							holder = scope:ElectionCandidate5
							change = scope:change
						}
					}
					every_in_list = {
						list = held_titles
						change_title_holder = {
							holder = scope:ElectionCandidate5
							change = scope:change
						}
					}
					resolve_title_and_vassal_change = scope:change
					hidden_effect = { change_government = republic_government }
					add_character_flag = {
						flag = RecentElection
						months = 60
					}
				}

				send_interface_toast = {
					type = event_toast_effect_good
					custom_tooltip = "You will play as them"
					title = "[ElectionCandidate5.GetName] has won the election"
					left_icon = scope:ElectionCandidate5
				}
			}
			25 = {
				custom_tooltip = "You win the election, and retain controll over the republic."
				send_interface_toast = {
					type = event_toast_effect_good
					#custom_tooltip = "You will play as them"
					title = "[republic_holder.GetName] has won the election"
					left_icon = scope:republic_holder
				}
			}
		}
	}
}