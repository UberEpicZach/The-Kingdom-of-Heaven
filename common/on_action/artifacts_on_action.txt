# Append on_actions to existing on_actions without replacing them
# CANNOT APPEND EFFECTS, ONLY ON_ACTIONS AND EVENTS!
on_game_start = {
	on_actions = {
		on_artifact_initialization
		#on_monthly_artifacts
	}
}
#on_game_start_after_lobby = {
#	on_monthly_artifacts
#}

on_death = {
	on_actions = {
		on_artifact_inheritance
	}
}

on_artifact_inheritance = {
	effect = {
		if = {
			limit = { exists = scope:killer }
			transfer_all_artifacts = { A = root B = scope:killer }	
		}
		else_if = {
			limit = { exists = root.primary_heir }
			transfer_all_artifacts = {A = root B = root.primary_heir}
		}
		else_if = {
			limit = { exists = root.liege_or_court_owner }
			transfer_all_artifacts = {A = root B = root.liege_or_court_owner}
		}
		else = {
			transfer_all_artifacts = {A = root B = root.location.barony_controller }
		}
	}
}

on_monthly_artifacts = {
	effect = {
		if = { # Attempt to reinitialize on old broken savegames
			limit = {
				NOT = {
					any_province = {
						exists = var:index
					}
				}
			}
			listify_all_typed_artifacts_as_flags = yes #Necessary for triggers.
			random_living_character = {initialize_province_indices = yes} #Necessary for the new selection system.
			every_artifact_holder = {
				every_in_list = {
					variable = artifact_list
					prev = {add_type_of_flag_artifact = {ARTIFACT = prev}}
				}
				refresh_filter = yes
			}
		}
		every_ai_artifact_holder = { #Equips Artifacts
			ai_equip_all_owned_artifacts = yes
		}
		every_player = {refresh_filter = yes}
	}
	on_actions = {
		delay = { months = 1 }
		on_monthly_artifacts
	}
}
on_artifact_initialization = { # Can be called by the scripted effect "initialize_artifacts" 
	effect = { # Add any artifact-specific setup that you don't want to put in your on_game_start or historical files.
		# If you want to assign artifacts in the history files instead of here, then it's recommended to put the initialization on a dummy character born at 1.1.1 by immediately calling an effect block.
		listify_all_typed_artifacts_as_flags = yes #Necessary for triggers.
		every_artifact_holder = {
			every_in_list = {
				variable = artifact_list
				prev = {add_type_of_flag_artifact = {ARTIFACT = prev}}
			}
			refresh_filter = yes
		}
		character:1316 = { #HRE 1066 ARTIFACTS
			add_artifact = {ARTIFACT = artifact_1}
			add_artifact = {ARTIFACT = artifact_3}
		}

		character:1732 = { #BYZANTINE 1066 ARTIFACTS
			add_artifact = {ARTIFACT = artifact_2}
		}

		character:1700 = { #BYZANTINE 867 ARTIFACTS
			add_artifact = {ARTIFACT = artifact_2}
		}

		character:30228 = { #LOMBARD 867 ARTIFACTS
			add_artifact = {ARTIFACT = artifact_3}		
		}

	}
	on_actions = {
		on_monthly_artifacts
	}
}

##### CUSTOM GUI COMPATIBILITY #####
# Once base gui has been initialized, create artifact GUI:
on_after_gui_dummy_male = {
	on_actions = {
		on_after_gui_dummy_male_artifacts
	}
}
# ROOT IS DUMMY_FEMALE
on_after_gui_dummy_female = {
	on_actions = {
		on_after_gui_dummy_female_artifacts
	}
}
# ROOT IS DUMMY_MALE
on_after_gui_dummy_male_artifacts = {
	effect  = {
		add_sidebar_button = {NAME = window_artifacts}
		add_custom_gui = {NAME = window_artifacts}
	}
}
# ROOT IS DUMMY_FEMALE
on_after_gui_dummy_female_artifacts = {
	on_actions = {
	}
}
# Ensure the artifact GUI exists even for people who are using outdated files.
on_monthly_artifacts = {
	on_actions = {
		ensure_GUI_exists
	}
}